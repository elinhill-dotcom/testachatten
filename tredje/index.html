<!doctype html>
<html lang="sv">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Kundservice-chatt ‚Äì anv√§ndartest</title>
  <style>
    :root {
      --bg:#f6f7f9; --card:#fff; --text:#111827; --muted:#6b7280;
      --radius:16px; --shadow:0 6px 24px rgba(0,0,0,.08); --border:#e5e7eb; --maxw:900px;
    }
    *{box-sizing:border-box} html{scroll-behavior:smooth}
    body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";background:var(--bg);color:var(--text)}
    [id]{scroll-margin-top:84px}

    .wrap{max-width:var(--maxw);margin:48px auto;padding:0 20px}
    .hero{background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);padding:28px}
    .brand{display:flex;align-items:center;gap:12px;margin-bottom:10px}
    .brand img{height:34px;width:auto;display:block}
    .eyebrow{font-size:14px;color:var(--muted);letter-spacing:.01em}
    h1{font-size:clamp(28px,3.2vw,40px);line-height:1.15;margin:6px 0 10px}
    .card{background:#fafafa;border:1px solid var(--border);border-radius:14px;padding:18px}
    .card p{margin:0 0 10px}
    .strong{font-weight:600}
    ul{margin:8px 0 0 18px;color:#374151}
    .kicker{margin-top:18px;font-size:14px;color:var(--muted)}

    /* Chat-ram */
    #chatbox{margin-top:28px}
    .chat-card{background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);overflow:hidden;border:1px solid var(--border)}
    .chat-header{display:flex;justify-content:space-between;align-items:center;gap:12px;padding:12px 14px;border-bottom:1px solid var(--border);background:#fafafa;font-weight:600}
    .chat-header .info{font-weight:500;color:#374151;font-size:.95rem}
    .chat-header a{font-weight:600;text-decoration:underline;color:#111827;font-size:.95rem}

    /* Embedded-container: g√∂r plats √•t chatten */
    #bp-embedded-webchat{
      width:100%;
      height:70vh;              /* justera vid behov */
      min-height:420px;
      display:block;
    }

    /* Flytande ‚ÄúTill toppen‚Äù-knapp */
    .to-top{position:fixed;right:16px;bottom:16px;z-index:9999;background:#111827;color:#fff;border:0;border-radius:999px;padding:12px 14px;box-shadow:0 6px 20px rgba(0,0,0,.2);opacity:0;pointer-events:none;transform:translateY(8px);transition:.2s}
    .to-top.show{opacity:1;pointer-events:auto;transform:translateY(0)}
    .to-top:focus-visible{outline:2px solid #111}

    /* Mobil */
    @media (max-width:640px){
      .wrap{margin:28px auto;padding:0 14px}
      .hero{padding:18px}
      .brand img{height:28px}
      h1{font-size:clamp(22px,6vw,28px)}
      .card,.chat-header{font-size:15px}
      .card{padding:14px}
      ul{margin-left:16px}
      .footer-cta{margin:18px 0 44px}
      .chat-header .info{font-size:.9rem}
      #bp-embedded-webchat{height:64vh;min-height:380px}
    }
  </style>
</head>
<body id="top">
  <main class="wrap">
    <section class="hero" aria-labelledby="title">
      <div class="brand">
        <img src="https://mau.se/siteassets/mau_sv_logotyp.svg" alt="Malm√∂ universitet" />
        <span class="eyebrow">Klara Axelsson och Elin Hill, studenter p√• Malm√∂ universitet, medie- och kommunikationsvetenskap.</span>
      </div>

      <h1 id="title">Testa v√•r kundservice-chatt</h1>

      <div class="card" id="instruktioner">
        <p><span class="strong">Din uppgift:</span> F√∂rs√∂k returnera ett par jeans som inte passade. <span class="strong">Ditt ordernummer √§r 12345.</span></p>
        <ul>
          <li><span class="strong">Tid:</span> cirka 3‚Äì5 minuter.</li>
          <li><span class="strong">Anonymitet:</span> ditt deltagande √§r anonymt och inga personuppgifter samlas in. Du kan avbryta n√§r som helst.</li>
        </ul>
        <p><strong>I slutet av chatten kommer en l√§nk till en enk√§t ‚Äì f√∂lj den och fyll i dina svar.</strong></p>
      </div>

      <p class="kicker">Om du inte ser chatten, prova att uppdatera sidan eller st√§nga av adblocker.</p>
    </section>

    <!-- CHAT ‚Äì rubrik + l√§nk upp -->
    <section id="chatbox" class="chat-card" aria-label="Chatten">
      <div class="chat-header">
        <span>Chatten</span>
        <span class="info">Embedded-l√§ge: chattrutan visas nedan.</span>
        <a href="#top" class="back-to-top">Till instruktionerna ‚Üë</a>
      </div>

      <!-- ‚¨áÔ∏è ‚¨áÔ∏è EMBED-CONTAINER (ny) ‚¨áÔ∏è ‚¨áÔ∏è -->
      <div id="bp-embedded-webchat" aria-label="Inb√§ddad chatt"></div>
      <!-- ‚¨ÜÔ∏è ‚¨ÜÔ∏è EMBED-CONTAINER ‚¨ÜÔ∏è ‚¨ÜÔ∏è -->
    </section>
  </main>

  <!-- Flytande ‚ÄúTill toppen‚Äù-knapp -->
  <button id="toTopBtn" class="to-top" aria-label="Till instruktionerna">‚Üë Till toppen</button>

  <script>
    // Flytande ‚ÄúTill toppen‚Äù
    const toTop = document.getElementById('toTopBtn');
    function onScroll(){ if (window.scrollY > 300) toTop.classList.add('show'); else toTop.classList.remove('show'); }
    window.addEventListener('scroll', onScroll, {passive:true}); onScroll();

    // Tvinga scroll till allra h√∂gst upp (mobil/iOS-s√§kert)
    function smoothScrollTop(e){
      e?.preventDefault?.();
      history.replaceState(null, '', location.pathname + location.search);
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }
    document.querySelectorAll('a[href="#top"], .back-to-top, #toTopBtn')
      .forEach(el => el.addEventListener('click', smoothScrollTop));
    window.addEventListener('hashchange', () => {
      if (location.hash === '#top') smoothScrollTop();
    }, { passive: true });

    // Extra ankarmarginal p√• mobil
    const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
    if (isMobile) document.querySelectorAll('[id]').forEach(el => el.style.scrollMarginTop = '120px');
  </script>

  <!-- Botpress ‚Äì scripts -->
  <script src="https://cdn.botpress.cloud/webchat/v3.3/inject.js"></script>
  <script src="https://files.bpcontent.cloud/2025/10/14/08/20251014084554-67IVFLND.js"></script>

  <!-- üîß Tvinga embedded-l√§ge oavsett extern konfig -->
  <script>
    (function ensureEmbedded(){
      function mountEmbedded(){
        // Om extern filen redan initierat webchatten kan vi sl√• ihop/√∂verstyra
        if (window.botpressWebChat?.mergeConfig) {
          window.botpressWebChat.mergeConfig({
            container: '#bp-embedded-webchat',
            hideWidget: true,            // d√∂lj den flytande bubblan
            layout: { width: '100%', height: '100%' }
          });
          // S√§kerst√§ll att den visas i containern
          if (window.botpressWebChat.sendEvent) {
            window.botpressWebChat.sendEvent({ type: 'show' });
          }
          return true;
        }
        // Om mergeConfig saknas, testa init (beroende p√• version)
        if (window.botpressWebChat?.init) {
          try {
            window.botpressWebChat.init({
              container: '#bp-embedded-webchat',
              hideWidget: true,
              layout: { width: '100%', height: '100%' }
              // √ñvriga v√§rden (clientId, botId, etc.) kommer fr√•n den externa .js:en
            });
            return true;
          } catch(e){}
        }
        return false;
      }

      // K√∂r n√§r scriptsen laddats klart
      const tryMount = () => {
        if (!mountEmbedded()) setTimeout(tryMount, 100);
      };

      // K√∂r efter DOMContentLoaded (om redan redo, k√∂r direkt)
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', tryMount);
      } else {
        tryMount();
      }
    })();
  </script>
</body>
</html>
